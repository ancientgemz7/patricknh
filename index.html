<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Garou Catch — Basket Swap</title>
<style>
  :root { --ui-bg: rgba(0,0,0,0.45); --accent:#ffd34d; }
  *{box-sizing:border-box; user-select:none}
  body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background: url('grass.png') center/cover no-repeat;
    height:100vh; color:#fff;
    display:flex; flex-direction:column; align-items:center;
  }

  header{
    width:100%; max-width:1100px; padding:12px 16px;
    display:flex; gap:20px; align-items:center; justify-content:space-between;
    margin-top:10px;
  }

  #score{ font-size:20px; background:var(--ui-bg); padding:8px 12px; border-radius:8px; }
  #hearts{ font-size:20px; background:var(--ui-bg); padding:8px 12px; border-radius:8px; color:#ff6b6b; }

  #controls{ display:flex; gap:8px; align-items:center; background:var(--ui-bg); padding:8px; border-radius:8px; }
  #controls label{ font-size:13px; margin-right:6px; color:#eee; }

  #stage{
    width:1000px; max-width:98vw; height:640px; margin:18px 0;
    border-radius:12px; border:3px solid rgba(255,255,255,0.2);
    overflow:hidden; position:relative;
    background: linear-gradient(to bottom, rgba(0,0,0,0.06), rgba(0,0,0,0.18));
  }

  /* basket uses background-image set by JS to allow swapping */
  #basket{
    position:absolute; bottom:14px; left:50%; transform:translateX(-50%);
    width:160px; height:110px; z-index:50; transition:filter 0.08s, transform 0.08s;
    background-position:center; background-size:contain; background-repeat:no-repeat;
  }

  .falling{
    position:absolute; width:110px; height:110px; top:-160px;
    background: url('garou.png') center/contain no-repeat; z-index:40;
  }

  .hitFlash{
    position:absolute; width:120%; height:120%; left:-10%; top:-10%;
    background: rgba(255,255,255,0.06); z-index:60; pointer-events:none;
  }

  #overlay{
    position:absolute; inset:0; display:none; align-items:center; justify-content:center;
    z-index:200; background: linear-gradient(180deg, rgba(0,0,0,0.4), rgba(0,0,0,0.6));
    color:#fff; text-align:center; padding:30px;
  }
  #overlay .panel{ background: rgba(0,0,0,0.7); padding:24px 36px; border-radius:12px; }
  #overlay button{ margin-top:12px; padding:10px 18px; background:var(--accent); border:none; border-radius:8px; cursor:pointer; }

  footer{ color:#ddd; font-size:13px; margin-bottom:18px; }
  @media (max-width:520px){ #basket{ width:110px; height:80px } .falling{ width:80px; height:80px } }
</style>
</head>
<body>
  <header>
    <div style="display:flex;gap:12px;align-items:center">
      <div id="score">Score: 0</div>
      <div id="hearts">❤️❤️❤️❤️❤️</div>
    </div>

    <div style="display:flex;align-items:center;gap:12px">
      <div id="controls">
        <label>Speed</label>
        <input id="speed" type="range" min="0.8" max="3.2" step="0.1" value="1.2">
        <label style="margin-left:8px">Spawn</label>
        <input id="spawn" type="range" min="400" max="1500" step="50" value="800">
      </div>
      <div style="font-size:13px;color:#eee;margin-left:10px">Mouse or ← → to move. Catch Garou to score. Miss 5 times → Game Over</div>
    </div>
  </header>

  <main id="stage">
    <div id="basket" aria-hidden="true"></div>

    <div id="overlay">
      <div class="panel">
        <h2 id="gameOverTitle">Game Over</h2>
        <p id="gameStats">Score: 0</p>
        <button id="restartBtn">Restart</button>
      </div>
    </div>
  </main>

  <footer>Garou Catch — use <code>garou.png</code>, <code>basket.png</code>, <code>basket_catch.png</code>, <code>grass.png</code></footer>

<script>
(() => {
  // CONFIG
  const STARTING_HEARTS = 5;
  const MISS_PENALTY_HEART = 1;
  const MAX_FALLING = 12;
  const CATCH_SWAP_MS = 220; // how long basket shows catch image

  // DOM
  const stage = document.getElementById('stage');
  const basket = document.getElementById('basket');
  const scoreEl = document.getElementById('score');
  const heartsEl = document.getElementById('hearts');
  const speedInput = document.getElementById('speed');
  const spawnInput = document.getElementById('spawn');
  const overlay = document.getElementById('overlay');
  const gameStats = document.getElementById('gameStats');
  const gameOverTitle = document.getElementById('gameOverTitle');
  const restartBtn = document.getElementById('restartBtn');

  // state
  let score = 0;
  let hearts = STARTING_HEARTS;
  let running = true;
  let fallingItems = []; // {el, x, y, speed}
  let lastTime = 0;
  let spawnTimer = 0;
  let moveDir = 0; // -1 left, 1 right
  let basketX = 0;
  const basketWidth = 160;

  // image names (must exist in same folder)
  const BASKET_NORMAL = 'basket.png';
  const BASKET_CATCH = 'basket_catch.png';

  // init
  function updateScore(){ scoreEl.textContent = "Score: " + score; }
  function updateHearts(){ heartsEl.innerHTML = "❤️".repeat(Math.max(0, hearts)); }
  updateScore(); updateHearts();

  // set initial basket image & position
  function setBasketImage(imgName){
    basket.style.backgroundImage = `url('${imgName}')`;
    basket.style.backgroundSize = 'contain';
  }
  setBasketImage(BASKET_NORMAL);

  // resize and position basket in center
  function layout(){
    const rect = stage.getBoundingClientRect();
    basketX = rect.width / 2;
    basket.style.left = (basketX - basketWidth/2) + 'px';
  }
  window.addEventListener('resize', layout);
  layout();

  // mouse movement
  stage.addEventListener('mousemove', (e) => {
    const rect = stage.getBoundingClientRect();
    const x = e.clientX - rect.left;
    basketX = clamp(x, basketWidth/2, rect.width - basketWidth/2);
    basket.style.left = (basketX - basketWidth/2) + 'px';
  });

  // keyboard movement
  window.addEventListener('keydown', (e) => {
    if (!running && e.key === 'r') restart();
    if (e.key === 'ArrowLeft') moveDir = -1;
    if (e.key === 'ArrowRight') moveDir = 1;
  });
  window.addEventListener('keyup', (e) => {
    if (e.key === 'ArrowLeft' && moveDir === -1) moveDir = 0;
    if (e.key === 'ArrowRight' && moveDir === 1) moveDir = 0;
  });

  // helpers
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function rand(min,max){ return Math.random()*(max-min)+min; }

  // spawn a single good Garou
  function spawnItem(){
    if (!running) return;
    if (fallingItems.length >= MAX_FALLING) return;

    const el = document.createElement('div');
    el.className = 'falling';
    const stageW = stage.clientWidth;
    const margin = 20;
    const x = rand(margin, stageW - 110 - margin);
    el.style.left = x + 'px';
    el.style.top = '-160px';
    stage.appendChild(el);

    const baseSpeed = parseFloat(speedInput.value);
    const speed = baseSpeed * rand(1, 1.5);

    fallingItems.push({ el, x, y:-160, speed });

    // clicking falling item also counts as catch
    el.addEventListener('click', () => handleCatch(el));
  }

  // when catching an item (either by collision or click)
  function handleCatch(el){
    const idx = fallingItems.findIndex(it => it.el === el);
    if (idx === -1) return;
    const it = fallingItems[idx];

    // increment score
    score += 1;
    updateScore();
    showHitFeedback(it.x, it.y);

    // swap basket image briefly
    swapBasketToCatch();

    // remove element
    it.el.remove();
    fallingItems.splice(idx,1);
  }

  function showHitFeedback(x,y){
    const flash = document.createElement('div');
    flash.className = 'hitFlash';
    flash.style.left = x + 'px';
    flash.style.top = (y - 30) + 'px';
    stage.appendChild(flash);
    setTimeout(()=>flash.remove(),220);
  }

  let catchTimeout = null;
  function swapBasketToCatch(){
    // show catch image briefly
    setBasketImage(BASKET_CATCH);
    basket.style.transform = 'translateX(-50%) scale(1.03)';
    if (catchTimeout) clearTimeout(catchTimeout);
    catchTimeout = setTimeout(() => {
      setBasketImage(BASKET_NORMAL);
      basket.style.transform = 'translateX(-50%)';
      catchTimeout = null;
    }, CATCH_SWAP_MS);
  }

  function missGood(){
    hearts -= MISS_PENALTY_HEART;
    updateHearts();
    if (hearts <= 0) endGame();
  }

  function endGame(){
    running = false;
    overlay.style.display = 'flex';
    gameOverTitle.textContent = 'Game Over';
    gameStats.textContent = 'Score: ' + score;
  }

  function restart(){
    fallingItems.forEach(it => it.el && it.el.remove());
    fallingItems = [];
    score = 0; hearts = STARTING_HEARTS; running = true;
    updateScore(); updateHearts();
    overlay.style.display = 'none';
    setBasketImage(BASKET_NORMAL);
    lastTime = performance.now();
    spawnTimer = 0;
    requestAnimationFrame(loop);
  }

  restartBtn.addEventListener('click', restart);

  // main loop
  function loop(now){
    if (!lastTime) lastTime = now;
    const dt = now - lastTime;
    lastTime = now;

    // keyboard basket movement
    if (moveDir !== 0){
      // responsive keyboard speed
      const kbSpeed = 0.6 * stage.clientWidth * 0.001 * (dt/16);
      basketX += moveDir * kbSpeed;
      basketX = clamp(basketX, basketWidth/2, stage.clientWidth - basketWidth/2);
      basket.style.left = (basketX - basketWidth/2) + 'px';
    }

    // update falling items
    for (let i = fallingItems.length -1; i >=0; i--){
      const it = fallingItems[i];
      it.y += it.speed * (dt / 16);
      it.el.style.top = it.y + 'px';

      // collision with basket?
      const itemRect = it.el.getBoundingClientRect();
      const basketRect = basket.getBoundingClientRect();
      if (rectsOverlap(itemRect, basketRect)){
        // caught by basket
        handleCatch(it.el);
        continue;
      }

      // if reached ground
      if (it.y > stage.clientHeight - 90){
        it.el.remove();
        fallingItems.splice(i,1);
        missGood();
      }
    }

    // spawn logic
    spawnTimer += dt;
    const spawnInterval = parseFloat(spawnInput.value);
    if (spawnTimer >= spawnInterval){
      spawnTimer = 0;
      spawnItem();
      if (Math.random() < 0.12) spawnItem(); // small chance to spawn second quickly
    }

    if (running) requestAnimationFrame(loop);
  }

  function rectsOverlap(a,b){
    return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
  }

  // click to move basket center
  stage.addEventListener('click', (e) => {
    const rect = stage.getBoundingClientRect();
    const x = e.clientX - rect.left;
    basketX = clamp(x, basketWidth/2, rect.width - basketWidth/2);
    basket.style.left = (basketX - basketWidth/2) + 'px';
  });

  // quick restart keys
  window.addEventListener('keydown', (e) => {
    if (!running && (e.key === 'Enter' || e.key === ' ')) restart();
  });

  // start loop
  lastTime = performance.now();
  requestAnimationFrame(loop);

  // helpers: clamp, rand already above

})();
</script>
</body>
</html>

